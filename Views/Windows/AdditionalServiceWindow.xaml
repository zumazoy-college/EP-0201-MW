<Window x:Class="EP_0201_MW.Views.Windows.AdditionalServiceWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:EP_0201_MW"
        Title="Дополнительные услуги по договору" 
        Height="600" Width="900"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize">

    <Grid Background="#ECF0F1" Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Информация о договоре -->
        <GroupBox Header="Информация о договоре" Grid.Row="0" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal" Margin="10">
                <StackPanel>
                    <TextBlock Text="Номер договора:" FontWeight="Bold" Margin="0,0,5,0"/>
                    <TextBlock Text="Клиент:" FontWeight="Bold" Margin="0,5,5,0"/>
                    <TextBlock Text="Склад:" FontWeight="Bold" Margin="0,5,5,0"/>
                </StackPanel>
                <StackPanel>
                    <TextBlock x:Name="TxtContractNumber" Margin="0,0,20,0"/>
                    <TextBlock x:Name="TxtClient" Margin="0,5,20,0"/>
                    <TextBlock x:Name="TxtWarehouse" Margin="0,5,20,0"/>
                </StackPanel>
            </StackPanel>
        </GroupBox>

        <!-- Добавление новой услуги -->
        <GroupBox Header="Добавить новую услугу" Grid.Row="1" Margin="0,0,0,10">
            <Grid Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Услуга:" Margin="0,0,0,5"/>
                    <ComboBox x:Name="CmbServices" DisplayMemberPath="Title" Height="30"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Margin="10,0,0,0">
                    <TextBlock Text="Дата оказания:" Margin="0,0,0,5"/>
                    <DatePicker x:Name="DatePickerServiceDate" Width="120" Height="30" />
                </StackPanel>

                <StackPanel Grid.Column="2" Margin="10,0,0,0">
                    <TextBlock Text="Количество:" Margin="0,0,0,5"/>
                    <TextBox x:Name="TxtQuantity" Text="1" Width="80" Height="30"/>
                </StackPanel>

                <Button Grid.Column="3" Content="➕ Добавить услугу" 
                       Click="BtnAddService_Click" Width="150" Height="35" 
                       Background="#27AE60" Foreground="White" BorderThickness="0" 
                       Cursor="Hand" Margin="20,20,0,0">
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="5"/>
                        </Style>
                    </Button.Resources>
                </Button>
            </Grid>
        </GroupBox>

        <!-- Список оказанных услуг -->
        <GroupBox Header="Список оказанных услуг" Grid.Row="3" Margin="0,0,0,10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <DataGrid x:Name="DGridProvidedServices" Grid.Row="0" 
                         AutoGenerateColumns="False" IsReadOnly="True"
                         Background="White" RowHeaderWidth="0">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Дата" 
                                           Binding="{Binding ServiceDate, StringFormat=\{0:dd.MM.yyyy\}}" 
                                           Width="100"/>
                        <DataGridTextColumn Header="Услуга" 
                                           Binding="{Binding Service.Title}" 
                                           Width="*"/>
                        <DataGridTextColumn Header="Описание" 
                                           Binding="{Binding Service.Description}" 
                                           Width="1.5*"/>
                        <DataGridTextColumn Header="Количество" 
                                           Binding="{Binding Quantity}" 
                                           Width="100"/>
                        <DataGridTextColumn Header="Цена за ед." 
                                           Binding="{Binding Service.Price, StringFormat=\{0:N2\} ₽}" 
                                           Width="120"/>
                        <DataGridTextColumn Header="Сумма" Width="120"
                                            Binding="{Binding CalculatedPrice, StringFormat={}{0:N2} ₽}"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </GroupBox>

        <!-- Кнопки управления -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Grid.Row="1" Content="🗑 Удалить выбранную услугу" 
                    Click="BtnDeleteService_Click" Width="200" Height="35" 
                    Background="#E74C3C" Foreground="White" BorderThickness="0" 
                    Cursor="Hand" Margin="0,0,15,0" HorizontalAlignment="Right">
                <Button.Resources>
                    <Style TargetType="Border">
                        <Setter Property="CornerRadius" Value="5"/>
                    </Style>
                </Button.Resources>
            </Button>
            
            <Button Content="Закрыть" Click="BtnClose_Click" Width="100" Height="35" 
                   Background="#7F8C8D" Foreground="White" BorderThickness="0" 
                   Cursor="Hand">
                <Button.Resources>
                    <Style TargetType="Border">
                        <Setter Property="CornerRadius" Value="5"/>
                    </Style>
                </Button.Resources>
            </Button>
        </StackPanel>
    </Grid>
</Window>